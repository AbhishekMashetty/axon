kubectl get events -n <your-namespace> --sort-by=.metadata.creationTimestamp --field-selector involvedObject.kind=Job -o json | jq -r '.items[] | select((.involvedObject.name | startswith("data-ingestion-")) and ((now - (.lastTimestamp | fromdate)) < 3600)) | "\(.lastTimestamp) \(.involvedObject.name) \(.message)"'


# Get all jobs (including completed ones) in the last hour
kubectl get jobs -n <namespace> --field-selector=metadata.name~=jasper- \
  --sort-by='.status.startTime' \
  -o custom-columns="NAME:.metadata.name,STATUS:.status.conditions[*].type,START_TIME:.status.startTime,COMPLETION_TIME:.status.completionTime"

# Alternative using grep for pattern matching
kubectl get jobs -n <namespace> -o json | jq -r '.items[] | select(.metadata.name | startswith("jasper-")) | select(.status.startTime != null) | select((.status.startTime | fromdateiso8601) > (now - 3600)) | [.metadata.name, .status.conditions[0].type, .status.startTime, .status.completionTime] | @csv'


# Using events to find evidence of deleted jobs
kubectl get events -n <namespace> --field-selector=involvedObject.kind=Job \
  --sort-by='.firstTimestamp' \
  -o custom-columns="TIME:.firstTimestamp,TYPE:.type,REASON:.reason,OBJECT:.involvedObject.name,MESSAGE:.message" | grep jasper-

# Get all jobs with extended time window
kubectl get jobs -n <namespace> -o json | jq -r '.items[] | select(.metadata.name | startswith("jasper-")) | select(.status.startTime != null) | select((.status.startTime | fromdateiso8601) > (now - 21600)) | [.metadata.name, .status.conditions[0].type, .status.startTime, .status.completionTime] | @csv'

# Find all job-related events in the last 6 hours
kubectl get events -n <namespace> \
  --field-selector=involvedObject.kind=Job \
  -o json | jq -r '.items[] | select(.involvedObject.name | startswith("jasper-")) | select((.firstTimestamp | fromdateiso8601) > (now - 21600)) | [.firstTimestamp, .type, .reason, .involvedObject.name, .message] | @csv'

# Count unique jasper jobs from events
kubectl get events -n <namespace> \
  --field-selector=involvedObject.kind=Job \
  -o json | jq -r '.items[] | select(.involvedObject.name | startswith("jasper-")) | select((.firstTimestamp | fromdateiso8601) > (now - 21600)) | .involvedObject.name' | sort | uniq | wc -l



# If you have access to audit logs
kubectl logs -n kube-system -l component=kube-apiserver | grep "jasper-" | grep "jobs" | grep -E "(CREATE|DELETE)" | tail -20

# Replace <namespace> with your actual namespace
kubectl get events -n <namespace> --field-selector=involvedObject.kind=Job -o json | jq '[.items[] | select(.involvedObject.name | startswith("jasper-")) | select((.firstTimestamp | fromdateiso8601) > (now - 21600))] | group_by(.involvedObject.name) | length'
